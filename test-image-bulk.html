<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>图片批量操作功能测试</title>
    <link rel="stylesheet" href="styles.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
</head>
<body>
    <div style="padding: 20px;">
        <h1>图片批量操作功能测试页面</h1>
        <p>这个页面用于测试图片批量操作和拖拽排序功能。</p>
        
        <button id="addTestImages" class="btn-primary" style="margin: 20px 0;">
            <i class="fas fa-plus"></i> 添加测试图片数据
        </button>
        
        <button id="clearData" class="btn-secondary" style="margin: 20px 0;">
            <i class="fas fa-trash"></i> 清空数据
        </button>
        
        <!-- 复制图片批量操作工具栏 -->
        <div class="image-bulk-toolbar" id="imageBulkToolbar">
            <div class="bulk-toolbar-left">
                <button id="toggleBulkMode" class="btn-secondary bulk-toggle-btn">
                    <i class="fas fa-check-square"></i>
                    批量选择
                </button>
                <span class="bulk-selection-info" id="bulkSelectionInfo" style="display: none;">
                    已选择 <span class="selected-count">0</span> 张图片
                </span>
            </div>
            
            <div class="bulk-toolbar-right" id="bulkActions" style="display: none;">
                <button id="selectAllImages" class="btn-secondary bulk-action-btn">
                    <i class="fas fa-check-double"></i>
                    全选
                </button>
                <button id="clearSelection" class="btn-secondary bulk-action-btn">
                    <i class="fas fa-times"></i>
                    清除选择
                </button>
                <div class="bulk-action-divider"></div>
                <button id="bulkDownload" class="btn-primary bulk-action-btn" disabled>
                    <i class="fas fa-download"></i>
                    下载
                </button>
                <button id="bulkMove" class="btn-secondary bulk-action-btn" disabled>
                    <i class="fas fa-folder"></i>
                    移动分类
                </button>
                <button id="bulkDelete" class="btn-danger bulk-action-btn" disabled>
                    <i class="fas fa-trash"></i>
                    删除
                </button>
            </div>
        </div>
        
        <!-- 图片显示区域 -->
        <div class="image-gallery" id="imagesGrid">
            <!-- 图片内容会动态生成 -->
        </div>
    </div>

    <!-- 批量移动分类模态框 -->
    <div class="modal" id="bulkMoveModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>移动到分类</h2>
                <button class="modal-close" id="closeBulkMoveModal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="bulk-move-info">
                    <i class="fas fa-info-circle"></i>
                    将 <span id="moveSelectionCount">0</span> 张图片移动到指定分类
                </div>
                <div class="form-group">
                    <label for="targetCategory">目标分类</label>
                    <select id="targetCategory" class="filter-select">
                        <option value="">请选择分类</option>
                        <option value="work">工作相关</option>
                        <option value="personal">个人生活</option>
                        <option value="study">学习资料</option>
                        <option value="design">设计素材</option>
                        <option value="other">其他分类</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="moveAddTags">添加标签（可选）</label>
                    <input type="text" id="moveAddTags" placeholder="用逗号分隔标签">
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn-secondary" id="cancelBulkMove">取消</button>
                <button class="btn-primary" id="confirmBulkMove" disabled>
                    <span class="btn-text">移动</span>
                    <span class="btn-loading" style="display: none;">
                        <i class="fas fa-spinner fa-spin"></i>
                        <span class="loading-text">移动中...</span>
                    </span>
                </button>
            </div>
        </div>
    </div>

    <!-- Toast 通知容器 -->
    <div class="toast-container" id="toastContainer"></div>

    <script src="script.js"></script>
    <script>
        // 等待页面加载完成
        document.addEventListener('DOMContentLoaded', () => {
            console.log('图片批量操作测试页面加载完成');
            
            // 添加测试数据按钮事件
            document.getElementById('addTestImages').addEventListener('click', () => {
                addTestImages();
            });
            
            // 清空数据按钮事件
            document.getElementById('clearData').addEventListener('click', () => {
                clearAllData();
            });
            
            // 初始化显示
            refreshImageDisplay();
        });
        
        // 添加测试图片数据
        function addTestImages() {
            if (!window.knowledgeBase) {
                console.error('知识库系统未初始化');
                return;
            }
            
            // 创建测试图片数据（使用占位图片）
            const testImages = [
                {
                    id: 'test-img-1',
                    name: '风景照片1.jpg',
                    type: 'image/jpeg',
                    size: 2 * 1024 * 1024,
                    tags: ['风景', '自然', '摄影'],
                    uploadDate: new Date('2024-01-15').toISOString(),
                    category: 'images',
                    dataUrl: 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzAwIiBoZWlnaHQ9IjIwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSIjNjY3ZWVhIi8+PHRleHQgeD0iNTAlIiB5PSI1MCUiIGZvbnQtZmFtaWx5PSJBcmlhbCIgZm9udC1zaXplPSIxOCIgZmlsbD0id2hpdGUiIHRleHQtYW5jaG9yPSJtaWRkbGUiIGR5PSIuM2VtIj7po47mp69nlLXniYc8L3RleHQ+PC9zdmc+'
                },
                {
                    id: 'test-img-2',
                    name: '工作截图.png',
                    type: 'image/png',
                    size: 1.5 * 1024 * 1024,
                    tags: ['工作', '截图', '文档'],
                    uploadDate: new Date('2024-02-10').toISOString(),
                    category: 'images',
                    dataUrl: 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzAwIiBoZWlnaHQ9IjIwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSIjMTBiOTgxIi8+PHRleHQgeD0iNTAlIiB5PSI1MCUiIGZvbnQtZmFtaWx5PSJBcmlhbCIgZm9udC1zaXplPSIxOCIgZmlsbD0id2hpdGUiIHRleHQtYW5jaG9yPSJtaWRkbGUiIGR5PSIuM2VtIj7lt6XkvZzmiq/lm608L3RleHQ+PC9zdmc+'
                },
                {
                    id: 'test-img-3',
                    name: '设计素材.jpg',
                    type: 'image/jpeg',
                    size: 3 * 1024 * 1024,
                    tags: ['设计', '素材', 'UI'],
                    uploadDate: new Date('2024-03-05').toISOString(),
                    category: 'images',
                    dataUrl: 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzAwIiBoZWlnaHQ9IjIwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSIjZjU5ZTBiIi8+PHRleHQgeD0iNTAlIiB5PSI1MCUiIGZvbnQtZmFtaWx5PSJBcmlhbCIgZm9udC1zaXplPSIxOCIgZmlsbD0id2hpdGUiIHRleHQtYW5jaG9yPSJtaWRkbGUiIGR5PSIuM2VtIj7orr7orqHntKDmnZA8L3RleHQ+PC9zdmc+'
                },
                {
                    id: 'test-img-4',
                    name: '家庭照片.jpg',
                    type: 'image/jpeg',
                    size: 2.5 * 1024 * 1024,
                    tags: ['家庭', '生活', '回忆'],
                    uploadDate: new Date('2024-03-20').toISOString(),
                    category: 'images',
                    dataUrl: 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzAwIiBoZWlnaHQ9IjIwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSIjZWY0NDQ0Ii8+PHRleHQgeD0iNTAlIiB5PSI1MCUiIGZvbnQtZmFtaWx5PSJBcmlhbCIgZm9udC1zaXplPSIxOCIgZmlsbD0id2hpdGUiIHRleHQtYW5jaG9yPSJtaWRkbGUiIGR5PSIuM2VtIj7lrrbluq3nhaflhaM8L3RleHQ+PC9zdmc+'
                },
                {
                    id: 'test-img-5',
                    name: '学习笔记.png',
                    type: 'image/png',
                    size: 1 * 1024 * 1024,
                    tags: ['学习', '笔记', '知识'],
                    uploadDate: new Date('2024-04-01').toISOString(),
                    category: 'images',
                    dataUrl: 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzAwIiBoZWlnaHQ9IjIwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSIjOGI1Y2Y2Ii8+PHRleHQgeD0iNTAlIiB5PSI1MCUiIGZvbnQtZmFtaWx5PSJBcmlhbCIgZm9udC1zaXplPSIxOCIgZmlsbD0id2hpdGUiIHRleHQtYW5jaG9yPSJtaWRkbGUiIGR5PSIuM2VtIj7lrabkuaDnrJHorrA8L3RleHQ+PC9zdmc+'
                },
                {
                    id: 'test-img-6',
                    name: '旅行照片.jpg',
                    type: 'image/jpeg',
                    size: 4 * 1024 * 1024,
                    tags: ['旅行', '风景', '回忆'],
                    uploadDate: new Date('2024-04-15').toISOString(),
                    category: 'images',
                    dataUrl: 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzAwIiBoZWlnaHQ9IjIwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSIjMDZiNmQ0Ii8+PHRleHQgeD0iNTAlIiB5PSI1MCUiIGZvbnQtZmFtaWx5PSJBcmlhbCIgZm9udC1zaXplPSIxOCIgZmlsbD0id2hpdGUiIHRleHQtYW5jaG9yPSJtaWRkbGUiIGR5PSIuM2VtIj7ml4XooYznhaflhaM8L3RleHQ+PC9zdmc+'
                }
            ];
            
            // 清空现有图片然后添加测试数据
            window.knowledgeBase.data.images = [];
            testImages.forEach(img => {
                window.knowledgeBase.data.images.push(img);
            });
            
            // 保存数据并刷新显示
            window.knowledgeBase.saveData();
            refreshImageDisplay();
            
            window.knowledgeBase.showToast('成功', `已添加 ${testImages.length} 张测试图片`, 'success');
        }
        
        // 清空所有数据
        function clearAllData() {
            if (!window.knowledgeBase) {
                console.error('知识库系统未初始化');
                return;
            }
            
            window.knowledgeBase.data.images = [];
            window.knowledgeBase.sortOrder = [];
            window.knowledgeBase.saveData();
            window.knowledgeBase.saveSortOrder();
            refreshImageDisplay();
            
            window.knowledgeBase.showToast('成功', '已清空所有图片数据', 'success');
        }
        
        // 刷新图片显示
        function refreshImageDisplay() {
            if (!window.knowledgeBase) {
                console.error('知识库系统未初始化');
                return;
            }
            
            // 初始化图片批量操作功能
            window.knowledgeBase.setupImageBulkOperations();
            window.knowledgeBase.showImages();
        }
    </script>
</body>
</html>